syntax = "proto3";
option csharp_namespace = "BlazorBoilerplate.Server";

import "google/protobuf/timestamp.proto";
import "google/protobuf/any.proto";
import "Enumerations.proto";
import "ModelRelatedMessages.proto";

message DeleteTrainingRequest {
  /*
    Unique user id generated by the controller on the create new user request from the frontend. Linked to a AspNetUser saved within the MS Sql database of the frontend
    example: '4a7af128-ac3d-4e3d-89fe-b70f7bfe0c3b'
  */
  string userId = 1;
  /*
    Unique training id generated when inserting a new training document into MongoDB
    example: "63525870394eff35ee175bc2"
  */
  string trainingId = 2;
}

message DeleteTrainingResponse {

}

message GetTrainingsRequest {
  /*
    Unique user id generated by the controller on the create new user request from the frontend. Linked to a AspNetUser saved within the MS Sql database of the frontend
    example: '4a7af128-ac3d-4e3d-89fe-b70f7bfe0c3b'
  */
  string userId = 1;
}

message GetTrainingsResponse {
  /*
    List of training records from MongoDB (see Training for more detals)
    example: [Training, Training]
  */
  repeated Training trainings = 1;
}

message GetTrainingRequest {
  /*
    Unique user id generated by the controller on the create new user request from the frontend. Linked to a AspNetUser saved within the MS Sql database of the frontend
    example: '4a7af128-ac3d-4e3d-89fe-b70f7bfe0c3b'
  */
  string userId = 1;
  /*
    Unique training id generated when inserting a new training document into MongoDB
    example: '63515c86b10d04d230dc1482'
  */
  string trainingId = 2;
}

message GetTrainingResponse {
  /*
    Training record from MongoDB (see Training for more detals)
    example: Training
  */
  Training training = 1;
}

message Training {
  /*
    Unique training id generated when inserting a new training document into MongoDB
    example: '63515c86b10d04d230dc1482'
  */
  string id = 1;
  /*
    Unique dataset id generated when inserting a new dataset document into MongoDB
    example: '63515c86b10d04d230dc1482'
  */
  string datasetId = 2;
  /*
    List of model records from MongoDB (see Model for more detals)
    example: [Model, Model]
  */
  repeated Model models = 3;
  /*
    Current training activity status (busy, completed, failed)
    example: "busy"
  */
  string status = 4;
  /*
    Training Configuration object (see Configuration for more detals)
    example: Configuration
  */
  Configuration configuration = 5;
  /*
    The current dataset configuration used to open the dataset as a JSON string
    example: '{
    "use_header": true,
    "start_row": 1,
    "delimiter": "comma",
    "escape_character": "\\",
    "decimal_character": "."
  }'
  */
  string datasetConfiguration = 6;
  /*
    The Training runtime profile object (see TrainingRuntimeProfile for more details)
    example: TrainingRuntimeProfile
  */
  TrainingRuntimeProfile RuntimeProfile = 7;
}

message Configuration {
  /*
    The selected ML task set during the wizard configuration
    example: ":tabular_classification"
  */
  string task = 1;
  /*
    The dataset target, if required by ML task set during the wizard configuration
    example: "Survived"
  */
  string target = 2;
  /*
    List of enabled strategies ids the blackboard will try during the training selected during the wizard configuration
    example: ['data_preparation.ignore_redundant_features']
  */
  repeated string enabledStrategies = 3;
  /*
    The maximum amount of time in minute the training can run before cancelation set during the wizard configuration
    example: 5
  */
  int32 runtimeLimit = 4;
  /*
    The ML metric selected during the wizard configuration
    example: ":accuracy"
  */
  string metric = 5;
  /*
    List of AutoML solutions selected during the wizard configuration
    example: [":autokeras", ":mljar"]
  */
  repeated string selectedAutoMlSolutions = 6;
  /*
    List of ML libraries selected during the wizard configuration
    example: [":keras_lib", ":sklearn_lib"]
  */
  repeated string selectedMlLibraries = 7;
  /*
    Map of additional parameters
    examples:
    {
      ":use_approach": { "values": [":adaboost", ":decision_tree"]},
      ":metric": { "values": [":accuracy"]},
      ":some_int": { "values": ["17"]}
    }
  */
  map<string, DynamicParameterValue> parameters = 8;
}

message TrainingRuntimeProfile {
  /*
    The timestamp when the training process started
    example: 1666283732325
  */
  google.protobuf.Timestamp startTime = 1;
  /*
    The timestamp when the training process ended
    example: 1666283732325
  */
  google.protobuf.Timestamp endTime = 2;
  /*
    List of StrategyControllerEvent objects (see StrategyControllerEvent for more detals)
    example: [StrategyControllerEvent, StrategyControllerEvent]
  */
  repeated StrategyControllerEvent events = 3;
}


message StrategyControllerEvent {
  /*
    The event type name set by the blackboard
    example: "phase_update"
  */
  string type = 1;
  /*
    JSON string of meta information related to the type
    example:
    {
      "old_phase": null,
      "new_phase": "started"
    }
  */
  string meta = 2;
  /*
    The timestamp when the event happened
    example: 1666283732325
  */
  google.protobuf.Timestamp timestamp = 3;
}


message CreateTrainingRequest {
  /*
    Unique user id generated by the controller on the create new user request from the frontend. Linked to a AspNetUser saved within the MS Sql database of the frontend
    example: '4a7af128-ac3d-4e3d-89fe-b70f7bfe0c3b'
  */
  string userId = 1;
  /*
    Unique dataset id generated when inserting a new dataset document into MongoDB
    example: '63515c86b10d04d230dc1482'
  */
  string datasetId = 2;
  /*
    Training Configuration object (see Configuration for more detals)
    example: Configuration
  */
  Configuration configuration = 3;
  /*
    The current dataset configuration used to open the dataset as a JSON string
    example: '{
    "use_header": true,
    "start_row": 1,
    "delimiter": "comma",
    "escape_character": "\\",
    "decimal_character": "."
  }'
  */
  string datasetConfiguration = 4;
}


message CreateTrainingResponse {
  /*
    Unique training id generated when inserting a new training document into MongoDB
    example: '63515c86b10d04d230dc1482'
  */
  string trainingId = 1;
}

/*
  Value type for dynamic training parameters for the auto ml solutions.
  This type is needed, because map<> does not supported "repeated" in the value.
*/
message DynamicParameterValue {
  /*
    List of values for a parameter
    examples:
    - int: ["17"]
    - single_value: [":accuracy"]
    - list: [":adaboost", ":decision_tree"]
  */
  repeated string values = 1;
}
